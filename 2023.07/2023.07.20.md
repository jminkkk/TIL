# Stub
4ì£¼ì°¨ ê³¼ì œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜€ë‹¤! ê³¼ì œì˜ ìƒì„¸ ì„¤ëª…ì€ ì•„ë˜ì™€ ê°™ë‹¤.

ì»¨íŠ¸ë¡¤ëŸ¬ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë’¤ ì†ŒìŠ¤ì½”ë“œë¥¼ ì—…ë¡œë“œ, stubì„ êµ¬í˜„
## Stubì´ë€?
ê³¼ì œë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” ì¼ë‹¨ Stubì— ëŒ€í•´ ì´í•´í•˜ê³  ìˆì—ˆì–´ì•¼ í–ˆëŠ”ë° Stubì— ëŒ€í•´ ì´í•´í•˜ëŠ” ê²ƒì— ì‹œê°„ì´ ì¡°ê¸ˆ ê±¸ë ¸ë˜ ê²ƒ ê°™ë‹¤.

ì—¬ëŸ¬ ì„œì¹˜ì™€ ê°•ì˜ ìë£Œë¥¼ í†µí•´ ë‚´ê°€ ì´í•´í•œ Stubì„ ê°„ë‹¨í•˜ê²Œ ë§í•˜ìë©´ ì–´ë–¤ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ, ê·¸ ê²°ê³¼ê°’ì„ ì„ì˜ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ë‹¤.





ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ë³´ë‚¸ ìš”ì²­ì— ëŒ€í•´ ìš”ì²­ì´ ì ì ˆí•œê°€ë¥¼ ê²€ì¦í•˜ê¸° ë•Œë¬¸ì— ê²°ê³¼ê°’ì´ ì‹¤ì œ ë°ì´í„°ì¸ì§€ëŠ” ì¤‘ìš”í•˜ì§€ ì•Šë‹¤.



## Stub ì ìš©
ì˜ˆì œë¥¼ í†µí•´ Stubì„ ì ìš©í•´ë³´ì. ì•„ë˜ëŠ” ì¥ë°”êµ¬ë‹ˆ ì „ì²´ ë‚´ì—­ ë³´ê¸°ì— ëŒ€í•´ ì§„í–‰í•œ í…ŒìŠ¤íŠ¸ì´ë‹¤.





ì¼ë‹¨, í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸°ì „ì— Controllerë‹¨ì„ í™•ì¸í•˜ìë©´, ì¥ë°”êµ¬ë‹ˆ ì „ì²´ ë‚´ì—­ ë³´ê¸° ("/carts", post) ë¥¼ ìš”ì²­ ì‹œì—ëŠ” ë‹¤ìŒì˜ ì¡°íšŒ ë‚´ì—­ë“¤ì´ í•„ìš”í•˜ë‹¤.

ì¥ë°”êµ¬ë‹ˆ ë‚´ì—­ë“¤ì„ ì•Œì•„ì•¼ í•˜ê³  (getCartList())
ì¥ë°”êµ¬ë‹ˆ ë‚´ì—­ë“¤ì„ ì•Œê¸° ìœ„í•´ì„œëŠ” ë‹´ì€ ì œí’ˆì˜ ì˜µì…˜ ë‚´ì—­(ì˜µì…˜, ìˆ˜ëŸ‰, ê°€ê²© ë“±)ì„ ì•Œì•„ì•¼ í•˜ê³  (getOptionList())
ì œí’ˆì˜ ì˜µì…˜ ë‚´ì—­ì„ ì•Œê¸° ìœ„í•´ì„œëŠ” ê·¸ ì œí’ˆì— ëŒ€í•´ ì•Œì•„ì•¼ í•œë‹¤. (getProductList())
1ì°¨ Stub ì ìš© (ì—ëŸ¬ ğŸ¤¯)
ì•ì—ì„œ ë§í–ˆë“¯ Stubì€ ì–´ë–¤ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ, ê·¸ ê²°ê³¼ê°’ì„ ì„ì˜ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ë‹¤.

ì¥ë°”êµ¬ë‹ˆë¥¼ ì¡°íšŒí•œ êµ¬í˜„í•œ Stub

        Mockito.when(fakeStore.getCartList()).thenReturn(
                Arrays.asList(
                        new Cart(1, user, fakeStore.getOptionList().get(0), 5, 50000),
                        new Cart(2, user, fakeStore.getOptionList().get(1), 5, 54500)
                )
        );
        // stub
        Mockito.when(fakeStore.getProductList()).thenReturn(
                Arrays.asList(new Product(1, "ê¸°ë³¸ì— ìŠ¬ë¼ì´ë”© ì§€í¼ë°± í¬ë¦¬ìŠ¤ë§ˆìŠ¤/í”Œë¼ì›Œì—ë””ì…˜ ì—ë””ì…˜ ì™¸ ì£¼ë°©ìš©í’ˆ íŠ¹ê°€ì „", "", "/images/1.jpg", 1000)
                )
        );

        Mockito.when(fakeStore.getOptionList()).thenReturn(
                Arrays.asList(
                        new Option(1, fakeStore.getProductList().get(0), "01. ìŠ¬ë¼ì´ë”© ì§€í¼ë°± í¬ë¦¬ìŠ¤ë§ˆìŠ¤ì—ë””ì…˜ 4ì¢…", 10000),
                        new Option(2, fakeStore.getProductList().get(0),"02. ìŠ¬ë¼ì´ë”© ì§€í¼ë°± í”Œë¼ì›Œì—ë””ì…˜ 5ì¢…", 10900)
                )
        );

        Mockito.when(fakeStore.getCartList()).thenReturn(
                Arrays.asList(
                        new Cart(1, user, fakeStore.getOptionList().get(0), 5, 50000),
                        new Cart(2, user, fakeStore.getOptionList().get(1), 5, 54500)
                )
        );


// (ê¸°ëŠ¥ 9) ì¥ë°”êµ¬ë‹ˆ ë³´ê¸°
    @WithMockUser(username = "ssar@nate.com", roles = "USER")
    @Test
    public void findAll_test() throws Exception {
        // given
        User user = User.builder()
                .id(1)
                .roles("ROLE_USER")
                .build();


        // stub
        Mockito.when(fakeStore.getProductList()).thenReturn(
                Arrays.asList(new Product(1, "ê¸°ë³¸ì— ìŠ¬ë¼ì´ë”© ì§€í¼ë°± í¬ë¦¬ìŠ¤ë§ˆìŠ¤/í”Œë¼ì›Œì—ë””ì…˜ ì—ë””ì…˜ ì™¸ ì£¼ë°©ìš©í’ˆ íŠ¹ê°€ì „", "", "/images/1.jpg", 1000)
                )
        );

        Mockito.when(fakeStore.getOptionList()).thenReturn(
                Arrays.asList(
                        new Option(1, fakeStore.getProductList().get(0), "01. ìŠ¬ë¼ì´ë”© ì§€í¼ë°± í¬ë¦¬ìŠ¤ë§ˆìŠ¤ì—ë””ì…˜ 4ì¢…", 10000),
                        new Option(2, fakeStore.getProductList().get(0),"02. ìŠ¬ë¼ì´ë”© ì§€í¼ë°± í”Œë¼ì›Œì—ë””ì…˜ 5ì¢…", 10900)
                )
        );

        Mockito.when(fakeStore.getCartList()).thenReturn(
                Arrays.asList(
                        new Cart(1, user, fakeStore.getOptionList().get(0), 5, 50000),
                        new Cart(2, user, fakeStore.getOptionList().get(1), 5, 54500)
                )
        );

        // when
        ResultActions result = mvc.perform(
                MockMvcRequestBuilders
                        .get("/carts")
                        .contentType(MediaType.APPLICATION_JSON)
        );
        String responseBody = result.andReturn().getResponse().getContentAsString();
        System.out.println("í…ŒìŠ¤íŠ¸ : " + responseBody);

        // then
ì»¨íŠ¸ë¡¤ëŸ¬ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë’¤ ì†ŒìŠ¤ì½”ë“œë¥¼ ì—…ë¡œë“œí•˜ì‹œì˜¤. 2. stubì„ êµ¬í˜„í•˜ì‹œì˜¤.

 

3. you are stubbing the behaviour of another mock inside before 'thenReturn' instruction is completed