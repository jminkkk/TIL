# 영속성 컨텍스트
## 영속성 컨텍스트란

엔티티를 영구 저장하는 환경 
+ 엔티티 매니저로 엔티티를 저장하거나 조회하면 엔티티 매니저는 영속성 컨텍스트에 엔티티를 보관, 관리

## 엔티티의 생명주기
+ 비영속
  + 영속성 컨텍스트와 전혀 관계가 없는 상태

+ 영속
  + 영속성 컨텍스트에 저장된 상태
  + 영속 상태라는 것은, 영속성 컨텍스트에 의해 관리된다는 뜻

+ 준영속
  + 영속성 컨텍스트에 저장되었다가 분리된 상태
  + 특정 엔티티를 준영속 상태로 만들려면 em.detach()를 호출하면 됨

+ 삭제
  + 삭제된 상태
  + 엔티티를 영속성 컨텍스트와 데이터베이스에서 삭제

## 영속성 컨텍스트의 특징
+ 영속성 컨텍스트와 식별자 값
  + 영속성 컨텍스트는 엔티티를 **식별자 값(@Id로 테이블의 기본 키와 매핑한 값)으로 구분** 
    + 따라서 영속 상태는 식별자 값이 반드시 있어야 함
    + 식별자 값이 없으면 예외가 발생

+ 영속성 컨텍스트와 데이터베이스 저장
  + JPA는 보통 트랜잭션을 커밋하는 순간 
  + 영속성 컨텍스트에 새로 저장된 엔티티를 데이터베이스에 반영하는데 이것을 플러시(flush)라고 함

## 영속성 컨텍스트의 장점
+ 1차캐시
+ 동일성보장
+ 트랜잭션을 지원하는 쓰기 지연
+ 변경감지
+ 지연로딩