L7, L4 스위치 + 로드밸런싱

# 로드밸런싱

서버가 단 하나만 존재할 경우, 과도한 트래픽이 몰리게 되면 부하를 감당하지 못하게 됨

→ 이런 경우 부하를 분산해야 하는데, 장비를 업그레이드하는 **Scale-up**방식과 장비를 여러개 두는 **Scale-out**방식이 있다.

### **Scale-out**

장비를 여러개 둠

- 말 그대로 컴퓨터를 여러개 더 사서 서버를 여러개 띄우는 것
- Scale-out 방식으로 여러 서버를 둔다면 해당 서비스에 접근하기 위해서는 서버마다 다른 IP 필요
    - 비용적인 측면에서 한두푼이 아니고 각 IP에 접근하는 사용자들을 적절하게 분산하기 힘듬 (50:50으로 분산되지 않고 1:99로 분산될 가능성도 있기에)

### **Scale-up**

장비를 업그레이드

- 기존 서버의 하드웨어를 교체해서 성능을 향상

### 결론 로드밸런싱이란

서버가 여러 개인(Scale-out) 경우에 **요청 트래픽을 적절하게 분산시켜주는** 서비스

- 즉, 컴퓨터 네트워크 기술의 일종으로 둘 혹은 셋이상의 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것을 의미
- 두개이상의 컴퓨터자원에 작업을 나누는것을 로드밸런싱이라고 하고, 이런 작업을 하는 장비를 **로드밸런서**라고 함

# 스위치(로드밸런서의 종류)

스위치란 **네트워크를 연결**하는 일을 하는 목적을 가진 **기기**

### 스위치의 역할

- 여러 개의 **네트워크 장치** 연결
- 이 장치들간의 데이터 **패킷을 수신 및 전송**
- 데이터의 흐름 제어

스위치는 OSI 7계층에서 어느 계층까지를 다루는지 기준으로 스위치의 카테고리를 나누는데, 그것들이 L7, L4 스위치이다.


## ****L4 스위치****

Layer 4(Transport Layer, 전송계층)에서 **IP와 Port를 활용하여 서버 부하분산을** 하는 스위치

- **TCP/UDP 프로토콜을** 기반으로 정보를 분석해 데이터의 전송 방향을 처리
    - 이때 주로 포트 정보를 활용
- L4 스위치는 패킷의 송수신을 모니터링하고 필요에 따라 트래픽을 제어

### ****L4 스위치 장단점****

- 장점
    - 패킷의 **헤더 정보만을 이용하기** 때문에 처리 속도가 빠르고 응답속도 또한 빠름
- 단점
    - 애플리케이션 계층의 정보를 활용하지 못하므로 기능, 유연성이 제한적
- 사용시기
    - 온라인 게임, 스트리밍 서비스 등 **실시간 트래픽** **처리가** 중요한 서비스에 적합

## ****L7 스위치****

Layer 7 프로토콜의 헤더를 분석하여 로드밸런싱을 하는 스위치

- HTTP 및 HTTPS 프로토콜을 기반으로 기반으로 클라이언트와 서버 간의 트래픽을 분산
    - 이때 요청 내용(URL, 헤더, 쿠키 등)를 활용
- IP, TCP/UDP 포트 및 패킷 내용까지 참조하는 장비
- L7은 L4 스위치의 **서비스 단위 로드밸런싱을 극복하기** 위해 포트 + 데이터 페이로드 패턴을 이용하여 패킷 스위칭

### ****L7 스위치 장단점****

- 장점
    - 요청 내용을 분석하여 특정 요청을 특정 서버로 전달하거나, 캐싱, 압축 등등 다양한 기능, 유연성을 가짐
- 단점
    - 패킷의 애플리케이션 계층 정보를 분석해야 하므로 처리속도가 상대적으로 느림
    - 비용이 매우 비쌈
- 사용시기
    - 웹 서비스, API 게이트웨이, 콘텐츠 전송 네트워크(CDN) 등 애플리케이션 레벨의 로드 밸런싱이 필요한 서비스에 적합

